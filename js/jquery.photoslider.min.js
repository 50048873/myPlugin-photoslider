!function(a){function b(c,d){this.wrapDom=a(d),a.extend(this,b.defaults,c),this.init()}b.defaults={currentIndex:0,imgs:void 0,height:"fullScreen",displayCount:!1,photoFill:!1,dotCls:"",caption:!1,captionWithTag:!1,showDots:!0,interval:2e3,auto:!0,onClick:function(a){}},b.prototype.init=function(){if("[object Array]"!==Object.prototype.toString.call(this.imgs))throw new Error("请传入图片列表数组");if(this.transform=this.getSurportCss("transform"),!this.transform)throw new Error("您的浏览器太旧，请升级到最新的浏览器！");this.getRealHeight(),this.drawDom(),this.auto&&this.autoPlay(),this.monitorTouch()},b.prototype.getRealHeight=function(){return this.windowW=window.innerWidth,this.windowH=window.innerHeight,"auto"===this.height?this.realHeight=this.getContainerHeight():"fullScreen"===this.height?this.realHeight=this.windowH:this.height<10?this.realHeight=this.windowW/this.height:this.realHeight=parseFloat(this.height),this.realHeight},b.prototype.getContainerHeight=function(){for(var a=this.imgs,b=a.length,c=0,d=[];c<b;c++)if(a[c].width/a[c].height>=1)d.push(a[c]);else if("number"!=typeof a[c].width||"number"!=typeof a[c].height)throw new Error("当高设置为自动计算时，传入的图片列表中必须要有图片的宽高");for(var e=0,f=[];e<d.length;e++)f.push(d[e].width/d[e].height);var g=Math.min.apply(null,f);return this.windowW/g},b.prototype.getImgSrc=function(a){var b="";if("string"==typeof a)b=a;else{if(!a.img)throw new Error("图片路径不对");b=a.img}return b},b.prototype.getImgWH=function(a){if(this.photoFill){if(a.width/a.height>=1)return'height="'+this.realHeight+'" style="max-width:none"';if(a.width/a.height<1)return'width="'+this.windowW+'" style="max-height:none"'}return""},b.prototype.getCaption=function(b){return this.caption&&this.captionWithTag?"<div>"+b.caption+"</div>":this.caption?"<div>"+a("<i></i>").html(b.caption).text()+"</div>":""},b.prototype.fixDotsPosition=function(){if(this.caption&&this.$dotsEle){var a=this.$ul.find("div").outerHeight(),b=this.$dotsEle.outerHeight();this.$dotsEle.css("bottom",(a-b)/2)}},b.prototype.drawDom=function(){var b=this.imgs,c=b.length,d=this.dotCls?" "+this.dotCls:"";this.$ul=a("<ul>").css({width:100*c+"%",height:this.realHeight}),this.showDots&&(this.$dotsEle=a('<div class="dots'+d+'">'));for(var e=0;e<c;e++){var f=b[e],g=["<li>",'<a href="'+(f.href||"javascript:;")+'"><img '+this.getImgWH(f)+' src="'+this.getImgSrc(f)+'" alt="photo" /></a>',this.getCaption(f),"</li>"].join("");g=a(g).css({width:this.windowW,left:this.windowW*e}),this.$ul.append(g),this.showDots&&this.$dotsEle.append("<span></span>")}this.displayCount&&(this.$countEle=a('<div class="count">'),this.$countEle.append("<span>"+(this.currentIndex+1)+"</span><span>/</span><span>"+c+"</span>")),this.wrapDom.append(this.$ul.add(this.$dotsEle).add(this.$countEle)),this.fixDotsPosition(),this.toggleDotsActive(0)},b.prototype.monitorTouch=function(){function b(a){this.startPageX=a.touches[0].pageX}function c(b){b.preventDefault(),this.offsetX=b.touches[0].pageX-this.startPageX;a(this).find("li");(0===e.currentIndex&&this.offsetX>0||e.currentIndex===e.imgs.length-1&&this.offsetX<0)&&(this.offsetX/=10),e.$ul.css(e.transform,"translate3d("+(-e.currentIndex*e.windowW+this.offsetX)+"px, 0, 0)")}function d(a){this.offsetX&&a.preventDefault();var b=e.windowW/6;return a.changedTouches[0].pageX==this.startPageX?void e.onClick.call(this,a):(this.offsetX<0&&Math.abs(this.offsetX)>b?e.currentIndex++:this.offsetX<e.windowW&&this.offsetX>b&&e.currentIndex--,void e.goTo())}var e=this,f=this.$ul[0];f.addEventListener("touchstart",b,!1),f.addEventListener("touchmove",c,!1),f.addEventListener("touchend",d,!1)},b.prototype.toggleDotsActive=function(a){this.wrapDom.find(".dots span").eq(a).addClass("active").siblings().removeClass("active"),this.wrapDom.find(".count span").eq(0).text(a+1)},b.prototype.getSurportCss=function(a){var b=document.createElement("div"),c="webkit moz ms".split(" "),d=c.length;if(a in b.style)return a;var e=function(a){var b=/\b(\w)|\s(\w)/g;return a.replace(b,function(a){return a.toUpperCase()})};for(a=e(a);d--;)if(c[d]+a in b.style)return c[d]+a;return!1},b.prototype.goTo=function(){this.$ul.css(this.transform,"translate3d("+this.windowW*-this.currentIndex+"px,0,0)"),this.toggleDotsActive(this.currentIndex)},b.prototype.resize=function(){var a=this;addEventListener("resize",function(){a.wrapDom.children().remove(),a.init(),a.goTo()},!1)},b.prototype.autoPlay=function(){var a=this,b=function(){a.timer&&clearInterval(a.timer),a.timer=setInterval(function(){a.currentIndex>=a.imgs.length-1?a.currentIndex=0:a.currentIndex++,a.goTo()},a.interval)};b();var c=function(){clearInterval(a.timer)},d=this.$ul[0];d.addEventListener("touchstart",c,!1),d.addEventListener("touchend",b,!1)},a.fn.slider=function(a){return this.each(function(c,d){this.instance=new b(a,this)})},window.Slider=b}(jQuery);